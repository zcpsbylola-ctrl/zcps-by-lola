<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ze agenda de réZervation by Lola</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #1a1442;
            --accent-gold: linear-gradient(135deg, #d4af37 0%, #f9e29c 50%, #b8860b 100%);
            --accent-gold-solid: #d4af37;
            --text-gold: #f9e29c;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --column-bg: rgba(46, 38, 94, 0.6);
            --selected-column-bg: rgba(58, 46, 122, 0.8);
            --slot-height: 20px;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--primary-bg);
            background-image: radial-gradient(circle at top, #2e265e 0%, #1a1442 100%);
            color: white;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 30px 20px 15px;
            text-align: center;
            background: linear-gradient(to bottom, rgba(26, 20, 66, 0.9), transparent);
            position: relative;
            z-index: 100;
        }

        header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 20px;
            margin: 0;
            color: var(--text-gold);
            font-weight: 400;
        }

        header h1 span { font-weight: 700; }

        /* Fixed Date Tabs Container */
        .date-tabs-outer {
            background: rgba(255, 255, 255, 0.95);
            margin: 0 10px;
            border-radius: 8px 8px 0 0;
            z-index: 90;
            overflow: hidden;
        }

        .date-tabs {
            display: flex;
            overflow-x: auto;
            scrollbar-width: none;
            scroll-behavior: smooth;
        }
        .date-tabs::-webkit-scrollbar { display: none; }

        .date-tab {
            flex: 0 0 33.33%; /* Show 3 days */
            padding: 12px 5px;
            text-align: center;
            color: #5a5a8a;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .date-tab.active {
            background: var(--selected-column-bg);
            color: white;
        }

        /* Scrollable Area */
        .main-scroll-area {
            flex: 1;
            display: flex;
            overflow: hidden;
            margin: 0 10px;
            background: rgba(255, 255, 255, 0.05);
            position: relative;
        }

        /* Time Labels (Fixed Left) */
        .time-column {
            width: 50px;
            flex-shrink: 0;
            background: rgba(26, 20, 66, 0.95);
            z-index: 80;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .time-labels-inner {
            display: flex;
            flex-direction: column;
        }

        .time-label {
            height: calc(var(--slot-height) * 4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
            border-bottom: 1px dashed rgba(255, 255, 255, 0.05);
        }

        /* Days Grid (Scrollable Horizontal & Vertical) */
        .grid-viewport {
            flex: 1;
            overflow: auto;
            scrollbar-width: none;
            scroll-snap-type: x mandatory;
            position: relative;
        }
        .grid-viewport::-webkit-scrollbar { display: none; }

        .days-container {
            display: flex;
            flex-direction: row;
            height: fit-content;
            width: fit-content;
        }

        .day-column {
            width: calc((100vw - 70px) / 1); /* Full width minus time col and margins */
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            background: var(--column-bg);
            scroll-snap-align: start;
            flex-shrink: 0;
        }

        .day-column.active {
            background: var(--selected-column-bg);
        }

        .slot {
            width: 100%;
            height: var(--slot-height);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            cursor: pointer;
            position: relative;
        }

        .slot.hour-mark {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .slot.blocked {
            background: rgba(0,0,0,0.3);
            pointer-events: none;
        }

        .slot-label-inner {
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 9px;
            color: rgba(255,255,255,0.3);
            opacity: 0;
        }
        .show-label .slot-label-inner { opacity: 1; }

        /* Selection Overlay */
        .selection-overlay {
            position: absolute;
            left: 4px;
            right: 4px;
            background: var(--accent-gold);
            border-radius: 6px;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            pointer-events: none;
            display: none;
        }

        .selection-overlay span {
            color: white;
            font-weight: 700;
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        /* Bottom Sheet */
        .bottom-sheet {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            transform: translateY(150%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .bottom-sheet.visible { transform: translateY(0); }

        .selected-info {
            font-size: 16px;
            margin-bottom: 15px;
            font-weight: 300;
            color: white;
        }

        .btn-validate {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 50px;
            background: var(--accent-gold);
            color: white;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Playfair Display', serif;
            box-shadow: 0 4px 15px rgba(184, 134, 11, 0.4);
        }

        .btn-validate:active { transform: scale(0.97); }

    </style>
</head>
<body>

<header>
    <h1>Ze agenda de ré<span>Z</span>ervation by <span>Lola</span></h1>
</header>

<div class="date-tabs-outer">
    <div class="date-tabs" id="dateTabs"></div>
</div>

<div class="main-scroll-area">
    <div class="time-column">
        <div class="time-labels-inner" id="timeLabels"></div>
    </div>
    <div class="grid-viewport" id="gridViewport">
        <div class="days-container" id="daysContainer">
            <div class="selection-overlay" id="selectionOverlay">
                <span id="overlayTime">10:45</span>
            </div>
        </div>
    </div>
</div>

<div class="bottom-sheet" id="bottomSheet">
    <div class="selected-info" id="selectedInfoText">Date — Heure</div>
    <button class="btn-validate" id="btnValidate">Valider</button>
</div>

<script>
    const MINUTES_IN_DAY = 24 * 60;
    const dateTabs = document.getElementById('dateTabs');
    const timeLabels = document.getElementById('timeLabels');
    const daysContainer = document.getElementById('daysContainer');
    const gridViewport = document.getElementById('gridViewport');
    const selectionOverlay = document.getElementById('selectionOverlay');
    const overlayTime = document.getElementById('overlayTime');
    const bottomSheet = document.getElementById('bottomSheet');
    const selectedInfoText = document.getElementById('selectedInfoText');
    const btnValidate = document.getElementById('btnValidate');

    let zoomLevel = 1;
    let slotHeight = 20;
    let daysCount = 0;
    let timelineData = [];

    const daysNames = ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'];
    const monthsNames = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Août', 'Sep', 'Oct', 'Nov', 'Déc'];

    function init() {
        for (let i = 0; i < 5; i++) addDay();
        renderTimeLabels();
        setupInfiniteScroll();
        setupSyncScroll();
        setupPinchToZoom();
        
        // Initial scroll to 08:00
        gridViewport.scrollTop = slotHeight * 4 * 8;
    }

    function addDay() {
        const date = new Date();
        date.setDate(date.getDate() + daysCount);
        const dayId = daysCount++;

        // Tab
        const tab = document.createElement('div');
        tab.className = 'date-tab';
        tab.id = `tab-${dayId}`;
        tab.innerHTML = `${daysNames[(date.getDay() + 6) % 7]} ${date.getDate()} ${monthsNames[date.getMonth()]}`;
        tab.onclick = () => {
            const col = document.getElementById(`col-${dayId}`);
            gridViewport.scrollTo({ left: col.offsetLeft, behavior: 'smooth' });
        };
        dateTabs.appendChild(tab);

        // Column
        const column = document.createElement('div');
        column.className = 'day-column';
        column.id = `col-${dayId}`;
        
        const slots = [];
        for (let m = 0; m < MINUTES_IN_DAY; m += 15) {
            const slot = document.createElement('div');
            slot.className = `slot ${m % 60 === 0 ? 'hour-mark' : ''}`;
            
            const timeStr = `${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`;
            const label = document.createElement('span');
            label.className = 'slot-label-inner';
            label.textContent = timeStr;
            slot.appendChild(label);

            slot.onclick = () => selectSlot(dayId, m, slot, timeStr, date);
            column.appendChild(slot);
            slots.push({ m, el: slot });
        }
        
        daysContainer.appendChild(column);
        timelineData.push({ dayId, date, column, slots });
        updateLabelsVisibility();
    }

    function renderTimeLabels() {
        timeLabels.innerHTML = '';
        for (let h = 0; h < 24; h++) {
            const label = document.createElement('div');
            label.className = 'time-label';
            label.textContent = `${h}:00`;
            timeLabels.appendChild(label);
        }
    }

    function selectSlot(dayId, minute, slotEl, timeStr, date) {
        if (slotEl.classList.contains('blocked')) return;

        document.querySelectorAll('.slot.blocked').forEach(s => s.classList.remove('blocked'));
        for (let i = 1; i < 5; i++) {
            const targetMinute = minute + (i * 15);
            const targetSlot = timelineData[dayId].slots.find(s => s.m === targetMinute);
            if (targetSlot) targetSlot.el.classList.add('blocked');
        }

        selectionOverlay.style.display = 'flex';
        selectionOverlay.style.height = `${slotHeight * 2}px`;
        selectionOverlay.style.top = `${slotEl.offsetTop}px`;
        selectionOverlay.style.left = `${timelineData[dayId].column.offsetLeft + 4}px`;
        selectionOverlay.style.width = `${timelineData[dayId].column.offsetWidth - 8}px`;
        overlayTime.textContent = timeStr;

        const dStr = `${date.getDate().toString().padStart(2,'0')}/${(date.getMonth()+1).toString().padStart(2,'0')}/${date.getFullYear()}`;
        selectedInfoText.textContent = `${dStr} — ${timeStr}`;
        bottomSheet.classList.add('visible');
        if (window.navigator.vibrate) window.navigator.vibrate(10);
    }

    function setupInfiniteScroll() {
        gridViewport.addEventListener('scroll', () => {
            // Horizontal Infinite
            if (gridViewport.scrollLeft + gridViewport.clientWidth >= gridViewport.scrollWidth - 50) {
                addDay();
            }

            // Update Tabs Active State & Scroll
            const colWidth = timelineData[0].column.offsetWidth;
            const activeIdx = Math.round(gridViewport.scrollLeft / colWidth);
            
            document.querySelectorAll('.date-tab').forEach((t, i) => {
                t.classList.toggle('active', i === activeIdx);
            });
            
            const activeTab = document.getElementById(`tab-${activeIdx}`);
            if (activeTab) {
                dateTabs.scrollTo({
                    left: activeTab.offsetLeft - (dateTabs.offsetWidth / 2) + (activeTab.offsetWidth / 2),
                    behavior: 'smooth'
                });
            }
        });
    }

    function setupSyncScroll() {
        // Sync vertical scroll of time column with grid
        gridViewport.addEventListener('scroll', () => {
            timeLabels.parentElement.scrollTop = gridViewport.scrollTop;
        });
    }

    function setupPinchToZoom() {
        let initialDist = null;
        gridViewport.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2) {
                const dist = Math.hypot(e.touches[0].pageX - e.touches[1].pageX, e.touches[0].pageY - e.touches[1].pageY);
                if (!initialDist) { initialDist = dist; return; }
                const scale = dist / initialDist;
                if (scale > 1.3 && zoomLevel < 4) { zoomLevel++; updateZoom(); initialDist = dist; }
                else if (scale < 0.7 && zoomLevel > 1) { zoomLevel--; updateZoom(); initialDist = dist; }
            }
        });
        gridViewport.addEventListener('touchend', () => { initialDist = null; });
    }

    function updateZoom() {
        const baseH = 20;
        slotHeight = baseH * zoomLevel;
        document.documentElement.style.setProperty('--slot-height', `${slotHeight}px`);
        
        // Hide overlay on zoom to avoid misplacement
        selectionOverlay.style.display = 'none';
        bottomSheet.classList.remove('visible');
        updateLabelsVisibility();
    }

    function updateLabelsVisibility() {
        document.querySelectorAll('.slot').forEach(slot => {
            const time = slot.querySelector('.slot-label-inner').textContent.split(':');
            const m = parseInt(time[1]);
            let show = false;
            if (zoomLevel === 1) show = (m === 0);
            if (zoomLevel === 2) show = (m === 0 || m === 30);
            if (zoomLevel >= 3) show = true;
            if (show) slot.classList.add('show-label');
            else slot.classList.remove('show-label');
        });
    }

    btnValidate.onclick = () => {
        const message = `Bonjour,\nJe souhaite réserver le créneau du ${selectedInfoText.textContent}.\nMerci ✨`;
        window.location.href = `https://wa.me/33605656753?text=${encodeURIComponent(message)}`;
    };

    init();
</script>

</body>
</html>
